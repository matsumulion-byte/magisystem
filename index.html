<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MAGI ACCESS // Nazo Challenge</title>
<style>
  :root{
    --bg:#05070a; --grid:#0f1a21; --stroke:#1e2a33; --muted:#8fbcc9;
    --accent:#3aff7b; --accent2:#ffb23a; --danger:#ff5454; --white:#eef7f2;
  }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--white);
    font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}
  header{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin-bottom:16px}
  .tag{border:1px solid var(--stroke);padding:4px 8px;border-radius:8px;font-size:12px}
  header h1{margin:0;font-size:14px;letter-spacing:.16em;color:#b9ffe6;flex:1 1 100%}

  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px}
  .magi{position:relative;border:1px solid var(--stroke);border-radius:12px;overflow:hidden;min-height:180px;
        background:linear-gradient(180deg,rgba(58,255,123,.06),rgba(58,255,123,.02));}
  .magi::before{content:"";position:absolute;inset:0;background:
      repeating-linear-gradient(90deg,var(--grid),var(--grid) 1px,transparent 1px,transparent 12px),
      repeating-linear-gradient(0deg,var(--grid),var(--grid) 1px,transparent 1px,transparent 12px);
      mix-blend-mode:soft-light;opacity:.9;pointer-events:none}
  .magi h2{margin:0;padding:10px 12px;background:#0a1218;border-bottom:1px solid var(--stroke);
           font-size:12px;letter-spacing:.15em;color:#8ef0c6;display:flex;justify-content:space-between;align-items:center}
  .lamp{width:8px;height:8px;border-radius:999px;background:#37434e;box-shadow:0 0 0 1px #182028 inset}
  .magi[data-state="accepted"] .lamp{background:var(--accent);box-shadow:0 0 10px var(--accent)}
  .magi .body{padding:12px;display:flex;flex-direction:column;gap:8px}
  .kbd{border:1px dashed var(--stroke);padding:4px 6px;border-radius:8px;color:#cfeee2;font-size:12px;display:inline-block}
  .btn{cursor:pointer;background:transparent;border:1px solid var(--stroke);color:var(--white);padding:8px 10px;border-radius:10px;font-size:14px}
  .btn:hover{border-color:var(--accent)}
  .status{font-size:11px;color:#9ddfc7;margin-top:auto}
  .ok{color:var(--accent)}.ng{color:var(--danger)}

  dialog{border:none;border-radius:14px;background:#0a0a0a;color:#fff;box-shadow:0 10px 40px rgba(0,0,0,.5);max-width:95vw;padding:0}
  dialog::backdrop{background:rgba(0,0,0,.6)}
  .modal-head{padding:12px 14px;border-bottom:1px solid #222;display:flex;gap:6px;align-items:center;font-size:14px}
  .modal-body{padding:12px;display:flex;flex-direction:column;gap:12px}

  .subtitle-card{position:relative;aspect-ratio:16/9;background:#000;border:2px solid #fff}
  .subtitle-card .num{position:absolute;top:8px;right:8px;font-size:14px;letter-spacing:.2em}
  .subtitle-card .ttl{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-family:"Yu Mincho","Hiragino Mincho ProN","MS PMincho",serif;font-size:28px;letter-spacing:.15em;font-weight:700}
  .subtitle-card .ttl span{writing-mode:vertical-rl;text-orientation:upright}

  .field{display:flex;gap:6px;align-items:center;flex-wrap:wrap}
  input[type="text"],input[type="email"],input[type="number"],select{flex:1;min-width:160px;background:#0e1317;border:1px solid #27353f;border-radius:10px;color:#eafff5;padding:10px 12px;letter-spacing:.05em;font-size:14px}
  .helper{font-size:11px;color:#9fb5be}

  .footer{margin-top:12px;display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;gap:10px}
  #apply{display:none}
  #apply.show{display:inline-flex}

  /* 応募フォーム専用 */
  form.entry{display:flex;flex-direction:column;gap:12px}
  .field-vert{display:flex;flex-direction:column;gap:6px}
  .field-vert label{font-size:12px;color:var(--muted)}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .row > *{flex:1 1 180px}
  textarea{min-height:80px;resize:vertical}
  .radio-group{display:flex;gap:10px;flex-wrap:wrap}
  .actions{display:flex;gap:10px;justify-content:flex-end;margin-top:6px}

  @media (max-width:540px){
    .wrap{padding:12px}
    dialog{width:100vw;height:100vh;border-radius:0}
    .modal-head{position:sticky;top:0;background:#0a0a0a;z-index:1}
    .modal-body{height:calc(100vh - 56px);overflow:auto;padding:14px}
    .btn{padding:12px 14px;font-size:16px}
    input[type="text"],input[type="email"],input[type="number"],select{padding:12px 14px;font-size:16px}
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <span class="tag">MAGI SYSTEM // ACCESS CHALLENGE</span>
    <h1>MELCHIOR-1 / BALTHASAR-2 / CASPER-3</h1>
    <span class="tag">3 PROBLEMS</span>
  </header>

  <div class="grid">
    <section class="magi" id="m1" data-state="idle">
      <h2><span>MELCHIOR-1</span><span class="lamp"></span></h2>
      <div class="body">
        <div class="kbd">第壱問：タップして表示</div>
        <button class="btn" data-open="q1">OPEN</button>
        <div class="status" id="s1">STATUS: 待機中…</div>
      </div>
    </section>

    <section class="magi" id="m2" data-state="idle">
      <h2><span>BALTHASAR-2</span><span class="lamp"></span></h2>
      <div class="body">
        <div class="kbd">第弐問：タップして表示</div>
        <button class="btn" data-open="q2">OPEN</button>
        <div class="status" id="s2">STATUS: 待機中…</div>
      </div>
    </section>

    <section class="magi" id="m3" data-state="idle">
      <h2><span>CASPER-3</span><span class="lamp"></span></h2>
      <div class="body">
        <div class="kbd">第参問：タップして表示</div>
        <button class="btn" data-open="q3">OPEN</button>
        <div class="status" id="s3">STATUS: 待機中…</div>
      </div>
    </section>
  </div>

  <div class="footer">
    <div class="helper">※全MAGI承認で <span style="color:var(--accent)">応募ボタン</span> が出現</div>
    <button id="apply" class="btn">応募する</button>
  </div>
</div>

<!-- 応募フォーム -->
<dialog id="entry">
  <div class="modal-head"><strong>応募フォーム</strong><span class="helper">（すべて入力してください）</span></div>
  <div class="modal-body">
    <form id="entryForm" class="entry" novalidate>
      <div class="row">
        <div class="field-vert">
          <label for="name">氏名</label>
          <input id="name" name="name" type="text" required placeholder="山田 太郎" />
        </div>
        <div class="field-vert">
          <label for="email">メールアドレス</label>
          <input id="email" name="email" type="email" required placeholder="example@mail.com" />
        </div>
      </div>
      <div class="field-vert">
        <label for="address">住所</label>
        <textarea id="address" name="address" required placeholder="都道府県・市区町村・番地・建物名"></textarea>
      </div>
      <div class="row">
        <div class="field-vert">
          <label>性別</label>
          <div class="radio-group">
            <label><input type="radio" name="gender" value="男性" required /> 男性</label>
            <label><input type="radio" name="gender" value="女性" /> 女性</label>
            <label><input type="radio" name="gender" value="その他" /> その他</label>
            <label><input type="radio" name="gender" value="無回答" /> 無回答</label>
          </div>
        </div>
        <div class="field-vert">
          <label for="age">年齢</label>
          <input id="age" name="age" type="number" min="0" max="120" required placeholder="例：28" />
        </div>
      </div>
      <div class="actions">
        <button type="button" class="btn" id="entryCancel">閉じる</button>
        <button type="submit" class="btn" id="entrySubmit">送信</button>
      </div>
    </form>
    <div id="entryDone" style="display:none">
      <div class="kbd">送信完了</div>
      <p class="helper">ご応募ありがとうございました。</p>
      <div class="actions"><button class="btn" id="entryCloseDone">閉じる</button></div>
    </div>
  </div>
</dialog>

<script>
window.MAGI_CONFIG = {
  answers: {
    q1:["スーパー","ｽｰﾊﾟｰ","super"],
    q2:["20","２０"],
    q3:["アルマロス","ｱﾙﾏﾛｽ","almaros"]
  },
  assets: { q1:[], q3:[] },
  onApply: ()=>{ const d=document.getElementById('entry'); if(d) d.showModal(); }
};
</script>
<script>
(function(){
  const CFG=window.MAGI_CONFIG;
  const norm=(s)=>{if(!s)return"";const z2h=t=>t.replace(/[！-～]/g,ch=>String.fromCharCode(ch.charCodeAt(0)-0xFEE0));const hira=t=>t.replace(/[ぁ-ん]/g,ch=>String.fromCharCode(ch.charCodeAt(0)+0x60));return hira(z2h(s)).replace(/\s+/g,"").toLowerCase();};
  const ans=CFG.answers;const state={q1:false,q2:false,q3:false};
  const applyBtn=document.getElementById('apply');
  const refresh=()=>{['m1','m2','m3'].forEach((id,i)=>{const q='q'+(i+1);document.getElementById(id).dataset.state=state[q]?'accepted':'idle'});
    if(state.q1&&state.q2&&state.q3)applyBtn.classList.add('show');};

  document.querySelectorAll('[data-open]').forEach(b=>b.addEventListener('click',()=>document.getElementById(b.getAttribute('data-open')).showModal()));
  document.getElementById('check1').addEventListener('click',()=>judge('q1','a1','s1'));
  document.getElementById('check2').addEventListener('click',()=>judge('q2','a2','s2'));
  document.getElementById('check3').addEventListener('click',()=>judge('q3','a3','s3'));
  ;['a1','a2','a3'].forEach((id,i)=>document.getElementById(id).addEventListener('keydown',e=>{if(e.key==='Enter')document.getElementById('check'+(i+1)).click();}));

  function judge(q,inputId,statusId){
    const ok=ans[q].some(x=>norm(x)===norm(document.getElementById(inputId).value));
    const s=document.getElementById(statusId);
    if(ok){state[q]=true;if(s)s.innerHTML='STATUS: <span class="ok">承認</span>';refresh();setTimeout(()=>{document.getElementById(q).close();},300);}else{state[q]=false;if(s)s.innerHTML='STATUS: <span class="ng">却下 - 再入力</span>';}}

  applyBtn.addEventListener('click',()=>CFG.onApply());

  // 応募フォーム submit 処理
  const entry=document.getElementById('entry');
  const form=document.getElementById('entryForm');
  const done=document.getElementById('entryDone');
  const cancelBtn=document.getElementById('entryCancel');
  const closeDone=document.getElementById('entryCloseDone');
  if(form){
    form.addEventListener('submit',(e)=>{
      e.preventDefault();
      const fd=new FormData(form);
      const requiredOK=['name','email','address','age'].every(k=>(fd.get(k)||'').toString().trim());
      const genderOK=!!fd.get('gender');
      const emailOK=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test((fd.get('email')||'').toString());
      const age=Number(fd.get('age'));
      const ageOK=Number.isFinite(age)&&age>=0&&age<=120;
      if(requiredOK&&genderOK&&emailOK&&ageOK){
        form.style.display='none';
        done.style.display='block';
      }else{
        alert('未入力、もしくは入力内容に誤りがあります。');
      }
    });
  }
  if(cancelBtn){ cancelBtn.addEventListener('click',()=> entry.close()); }
  if(closeDone){ closeDone.addEventListener('click',()=> entry.close()); }
})();
</script>
</body>
</html>